/*! For license information please see settings.js.LICENSE.txt */
(()=>{function e(){var n,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(e,o,i,a){var c=o&&o.prototype instanceof l?o:l,s=Object.create(c.prototype);return t(s,"_invoke",function(e,t,o){var i,a,c,l=0,s=o||[],d=!1,f={p:0,n:0,v:n,a:m,f:m.bind(n,4),d:function(e,t){return i=e,a=0,c=n,f.n=t,u}};function m(e,t){for(a=e,c=t,r=0;!d&&l&&!o&&r<s.length;r++){var o,i=s[r],m=f.p,p=i[2];e>3?(o=p===t)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=n):i[0]<=m&&((o=e<2&&m<i[1])?(a=0,f.v=t,f.n=i[1]):m<p&&(o=e<3||i[0]>t||t>p)&&(i[4]=e,i[5]=t,f.n=p,a=0))}if(o||e>1)return u;throw d=!0,t}return function(o,s,p){if(l>1)throw TypeError("Generator is already running");for(d&&1===s&&m(s,p),a=s,c=p;(r=a<2?n:c)||!d;){i||(a?a<3?(a>1&&(f.n=-1),m(a,c)):f.n=c:f.v=c);try{if(l=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=n}else if((r=(d=f.n<0)?c:e.call(t,f))!==u)break}catch(e){i=n,a=1,c=e}finally{l=1}}return{value:r,done:d}}}(e,i,a),!0),s}var u={};function l(){}function s(){}function d(){}r=Object.getPrototypeOf;var f=[][i]?r(r([][i]())):(t(r={},i,function(){return this}),r),m=d.prototype=l.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return s.prototype=d,t(m,"constructor",d),t(d,"constructor",s),s.displayName="GeneratorFunction",t(d,a,"GeneratorFunction"),t(m),t(m,a,"Generator"),t(m,i,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:p}})()}function t(e,n,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}t=function(e,n,r,o){function a(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?i?i(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},t(e,n,r,o)}function n(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(o,i){var a=e.apply(t,r);function c(e){n(a,o,i,c,u,"next",e)}function u(e){n(a,o,i,c,u,"throw",e)}c(void 0)})}}var o=1,i="gemini",a={ai:!0,drive:!1},c=document.getElementById("prev-btn"),u=document.getElementById("next-btn"),l=document.getElementById("error-message");function s(){return d.apply(this,arguments)}function d(){return(d=r(e().m(function t(){return e().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e){chrome.storage.sync.get(["geminiApiKey","geminiModel","claudeApiKey","claudeModel","googleDriveEnabled"],function(t){t.geminiApiKey&&(document.getElementById("gemini-api-key").value=t.geminiApiKey),t.geminiModel&&(document.getElementById("gemini-model").value=t.geminiModel),t.claudeModel&&(document.getElementById("claude-model").value=t.claudeModel),t.googleDriveEnabled&&(document.getElementById("feature-drive").checked=!0,a.drive=!0),e()})}))},t)}))).apply(this,arguments)}function f(){var e=document.getElementById("feature-ai"),t=document.getElementById("feature-drive");e.addEventListener("change",function(e){a.ai=e.target.checked}),t.addEventListener("change",function(e){a.drive=e.target.checked})}function m(){var e=document.querySelectorAll(".provider-option[data-provider]");e.forEach(function(t){t.addEventListener("click",function(){var n=t.querySelector('input[type="radio"]');n&&(n.checked=!0,i=n.value,e.forEach(function(e){return e.classList.remove("selected")}),t.classList.add("selected"))})}),document.querySelectorAll('input[name="provider"]').forEach(function(t){t.addEventListener("change",function(t){i=t.target.value,e.forEach(function(e){return e.classList.remove("selected")}),t.target.closest(".provider-option").classList.add("selected")})})}function p(){return y.apply(this,arguments)}function y(){return(y=r(e().m(function t(){var n;return e().w(function(e){for(;;)switch(e.n){case 0:if(B(),1!==o){e.n=2;break}if(a.ai||a.drive){e.n=1;break}return I("少なくとも1つの機能を選択してください"),e.a(2);case 1:e.n=5;break;case 2:if(3!==o||!a.ai){e.n=5;break}return e.n=3,h();case 3:if(e.v){e.n=4;break}return e.a(2);case 4:return e.n=5,E();case 5:(n=g())?(o=n,w()):4===o&&(chrome.tabs.create({url:chrome.runtime.getURL("editor.html")}),window.close());case 6:return e.a(2)}},t)}))).apply(this,arguments)}function v(){B();var e=2===o?1:3===o?a.ai?2:1:4===o?3:null;e&&(o=e,w())}function g(){if(1===o){if(a.ai)return 2;if(a.drive)return 3}else{if(2===o)return 3;if(3===o)return 4}return null}function h(){return b.apply(this,arguments)}function b(){return(b=r(e().m(function t(){var n;return e().w(function(e){for(;;)switch(e.n){case 0:if(!a.ai){e.n=4;break}if("gemini"!==i){e.n=3;break}if(n=document.getElementById("gemini-api-key").value.trim()){e.n=1;break}return I("Gemini APIキーを入力してください"),e.a(2,!1);case 1:if(n.startsWith("AIza")){e.n=2;break}return I("有効なGemini APIキーを入力してください（AIzaで始まる必要があります）"),e.a(2,!1);case 2:e.n=4;break;case 3:case 4:return e.a(2,!0)}},t)}))).apply(this,arguments)}function E(){return k.apply(this,arguments)}function k(){return(k=r(e().m(function t(){var n;return e().w(function(e){for(;;)if(0===e.n)return n={},a.ai&&("gemini"===i?(n.geminiApiKey=document.getElementById("gemini-api-key").value.trim(),n.geminiModel=document.getElementById("gemini-model").value):"claude"===i&&(n.claudeModel=document.getElementById("claude-model").value)),n.googleDriveEnabled=a.drive,e.a(2,new Promise(function(e){chrome.storage.sync.set(n,function(){console.log("設定を保存しました:",n),e()})}))},t)}))).apply(this,arguments)}function w(){document.querySelectorAll(".step").forEach(function(e){e.classList.remove("active")});var e,t,n,r=document.querySelector('.step[data-step="'.concat(o,'"]'));r&&r.classList.add("active"),document.querySelectorAll(".progress-step").forEach(function(e,t){var n=t+1;n<o?(e.classList.add("completed"),e.classList.remove("active")):n===o?(e.classList.add("active"),e.classList.remove("completed")):e.classList.remove("active","completed")}),1===o?(c.style.display="none",u.textContent="次へ →"):4===o?(c.style.display="none",u.textContent="エディターを開く"):(c.style.display="block",u.textContent="次へ →"),3===o&&(e=document.getElementById("gemini-form"),t=document.getElementById("claude-form"),n=document.getElementById("google-drive-form"),e.style.display="none",t.style.display="none",n.style.display="none",a.ai?"gemini"===i?e.style.display="block":t.style.display="block":a.drive&&(n.style.display="block",function(){L.apply(this,arguments)}()))}function L(){return(L=r(e().m(function t(){var n,r;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=document.getElementById("drive-status"),e.p=1,e.n=2,fetch("http://127.0.0.1:8080/api/status",{method:"GET",headers:{"Content-Type":"application/json"}});case 2:if(!(r=e.v).ok){e.n=4;break}return e.n=3,r.json();case 3:e.v,n.innerHTML='\n                <span style="color: #4caf50;">✓ 接続成功</span><br>\n                <small style="color: #666;">C#中継アプリが起動しています</small>\n            ',n.style.background="#e8f5e9",e.n=5;break;case 4:throw new Error("接続失敗");case 5:e.n=7;break;case 6:e.p=6,e.v,n.innerHTML='\n            <span style="color: #f44336;">✗ 接続できません</span><br>\n            <small style="color: #666;">C#中継アプリ（SightEditRelay.exe）を起動してください</small>\n        ',n.style.background="#ffebee";case 7:return e.a(2)}},t,null,[[1,6]])}))).apply(this,arguments)}function I(e){l.textContent=e,l.classList.add("show")}function B(){l.classList.remove("show")}document.addEventListener("DOMContentLoaded",r(e().m(function t(){return e().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,s();case 1:f(),m(),c.addEventListener("click",v),u.addEventListener("click",p),w();case 2:return e.a(2)}},t)})))})();