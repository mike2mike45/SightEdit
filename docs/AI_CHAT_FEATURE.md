# AI チャット機能 - ユーザーガイド

## 📋 概要

SightEditのAIチャット機能は、エディター内でAIとリアルタイムに対話できる統合チャットシステムです。文章作成のアシスタントとして、アイデアのブレインストーミング、文章の改善提案、翻訳など、様々なタスクをサポートします。

## ✨ 主要機能

### 1. リアルタイムチャット
- **ストリーミング応答**: AIの応答をリアルタイムで表示
- **Markdown対応**: 応答内容をリッチテキストで表示
- **XSS保護**: DOMPurifyによる安全なHTML表示

### 2. コンテキスト連携
チャット時にエディターのコンテンツをコンテキストとして送信できます：
- **なし**: コンテキストなしの一般的な会話
- **選択範囲**: エディターで選択したテキストを含める
- **ドキュメント全体**: 編集中のドキュメント全体を含める

### 3. 会話履歴管理
- **自動保存**: すべての会話を自動的にIndexedDBに保存
- **セッション検索**: キーワードでセッションを検索
- **フィルター機能**: すべて/お気に入り/今日/今週でフィルタリング
- **セッション操作**: 開く/お気に入り/削除

### 4. マルチAIプロバイダー対応
- Google Gemini
- Anthropic Claude
- 設定から簡単に切り替え可能

## 🚀 使い方

### チャットパネルを開く

3つの方法でチャットパネルを開けます：

1. **ツールバーボタン**: エディター上部の「💬 Chat」ボタンをクリック
2. **キーボードショートカット**: `Ctrl+K`（Mac: `Cmd+K`）
3. **プログラム**: `window.chatPanel.show()`

### メッセージを送信

1. チャットパネルの入力欄にメッセージを入力
2. 「送信」ボタンをクリック、または `Ctrl+Enter` で送信
3. AIの応答がリアルタイムで表示されます

### コンテキストを選択

チャットパネル上部のオプションから選択：
- ⚪ **コンテキストなし**: 一般的な会話
- ⚪ **選択範囲**: エディターで選択したテキストを含める
- ⚪ **ドキュメント全体**: 編集中のドキュメント全体を含める

### 会話履歴を管理

#### セッション一覧を開く
- チャットパネルヘッダーの「📋 履歴」ボタンをクリック
- またはキーボードショートカット: `Ctrl+H`

#### セッションを検索
- 検索ボックスにキーワードを入力
- タイトルまたはメッセージ内容で検索

#### セッションをフィルター
- **すべて**: すべてのセッションを表示
- **お気に入り**: お気に入りに追加したセッションのみ
- **今日**: 今日更新されたセッション
- **今週**: 過去7日間に更新されたセッション

#### セッション操作
- **開く**: セッションを読み込んで会話を再開
- **⭐/☆**: お気に入りに追加/削除
- **削除**: セッションを完全に削除（確認ダイアログあり）

### 新しい会話を開始

- チャットパネルヘッダーの「➕」ボタンをクリック
- または「クリア」ボタンで現在の会話をクリア
- キーボードショートカット: `Ctrl+L`（確認ダイアログあり）

### メッセージアクション

各AIメッセージには以下のアクションがあります：
- **📋 コピー**: メッセージをクリップボードにコピー
- **📝 挿入**: メッセージをエディターに挿入
- **🔄 再生成**: メッセージを再生成（未実装）

## ⌨️ キーボードショートカット

| ショートカット | 機能 |
|--------------|------|
| `Ctrl+K` / `Cmd+K` | チャットパネルのトグル（開く/閉じる） |
| `Ctrl+L` / `Cmd+L` | 会話をクリア |
| `Ctrl+H` / `Cmd+H` | 会話履歴を開く（Phase 1.8で実装） |
| `Ctrl+P` / `Cmd+P` | プロンプトライブラリを開く（Phase 2で実装） |
| `Ctrl+Enter` | メッセージを送信 |

## 🔧 設定

### AI プロバイダーの設定

1. チャットパネルヘッダーの「⚙️」ボタンをクリック
2. AIプロバイダーを選択（Gemini または Claude）
3. APIキーとモデルを設定
4. 「保存」をクリック

### ストレージ管理

会話データは以下に保存されます：
- **IndexedDB**: すべての会話履歴（無制限）
- **Chrome Storage (local)**: 最近の設定とセッション情報

## 💡 使用例

### 例1: 文章の改善を依頼

1. エディターで改善したい文章を選択
2. コンテキストオプションで「選択範囲」を選択
3. チャットで「この文章をもっと分かりやすく書き直してください」と送信
4. AIの提案を確認し、気に入ったら「📝 挿入」ボタンでエディターに挿入

### 例2: ブログ記事のアイデア出し

1. コンテキストオプションで「コンテキストなし」を選択
2. 「〇〇についてのブログ記事のアイデアを5つ提案してください」と送信
3. 気に入ったアイデアをエディターに挿入

### 例3: 技術文書の作成

1. コンテキストオプションで「ドキュメント全体」を選択
2. 「現在の内容を元に、API仕様書を作成してください」と送信
3. AIが現在のドキュメント全体を理解して仕様書を生成

### 例4: 過去の会話を再開

1. 「📋 履歴」ボタンで会話履歴を開く
2. 検索またはフィルターで目的のセッションを見つける
3. 「開く」ボタンでセッションを読み込む
4. 会話の続きを開始

## 🔒 プライバシーとセキュリティ

- **ローカル保存**: すべての会話データはローカルのIndexedDBに保存されます
- **APIキーの安全性**: APIキーはChrome Storageに暗号化されて保存されます
- **XSS保護**: DOMPurifyによりすべてのHTML出力を自動的にサニタイズ
- **データ削除**: 不要なセッションはいつでも完全に削除できます

## 🐛 トラブルシューティング

### チャットパネルが表示されない

1. ページを再読み込みしてください
2. ブラウザのコンソールでエラーを確認してください
3. `window.chatPanel` が存在するか確認してください

### メッセージが送信できない

1. AI設定を確認してください（⚙️ボタン）
2. APIキーが正しく設定されているか確認してください
3. ネットワーク接続を確認してください
4. コンソールでエラーメッセージを確認してください

### 会話履歴が表示されない

1. IndexedDBが有効か確認してください
2. ブラウザのストレージ容量を確認してください
3. コンソールで `await window.chatStorage.getAllSessions()` を実行してセッション数を確認してください

### ストリーミングが動作しない

1. 選択したAIプロバイダーがストリーミングをサポートしているか確認してください
2. ネットワーク接続が安定しているか確認してください
3. APIキーの権限を確認してください

## 📊 統合テスト

### ブラウザコンソールでのテスト

エディターページを開いて、コンソールで以下を実行：

```javascript
// すべてのテストを実行
await runAllTests()

// 統合テストのみ
await runPhase1IntegrationTest()

// パフォーマンステストのみ
await runPerformanceTest()
```

### テスト項目

- ✅ 初期化確認
- ✅ IndexedDB接続
- ✅ セッション作成・保存・読み込み
- ✅ セッション検索
- ✅ UI コンポーネント
- ✅ Markdown レンダリング
- ✅ XSS保護
- ✅ パフォーマンス（メッセージ表示、DB操作）

## ✅ Phase 2: プロンプト管理機能（完了）

Phase 2の機能がすべて実装されました！詳細は [Phase 2 プロンプト管理機能ガイド](./PHASE2_PROMPT_MANAGEMENT.md) をご覧ください。

### 実装済み機能
- ✅ カスタムプロンプトテンプレート管理（CRUD操作）
- ✅ プロンプトライブラリUI（検索、フィルター、カテゴリー分類）
- ✅ 25種類のデフォルトテンプレート
- ✅ 変数システム（`{{変数名}}` 形式）
- ✅ 文章生成モード（続きを書く、書き直す、展開する、要約する、パラフレーズ、アウトライン生成）
- ✅ インポート/エクスポート機能（JSON形式）
- ✅ お気に入り機能
- ✅ 最近使用したテンプレート
- ✅ ダークモード対応

## 🚧 今後の機能（Phase 3）

### Phase 3: 高度な機能
- スタイル制御（トーン、長さ、対象読者）
- 構造化生成（ブログ記事、技術文書、プレゼン）
- テンプレートのバージョン管理とコミュニティ共有
- AI による自動テンプレート提案
- パフォーマンス最適化
- マルチ言語対応

## 📝 フィードバック

問題や改善提案がある場合は、GitHubのIssueでお知らせください。

---

**バージョン**: Phase 2.0
**最終更新**: 2025-10-24
